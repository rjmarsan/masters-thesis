\begin{algorithm}[t]
\dontprintsemicolon
\linesnumbered

\SetAlFnt{\sf}
\SetAlCapFnt{\sf}

\SetKwFunction{GetLastConsistentVersion}{get\_last\_consistent\_version}
\SetKwFunction{GetNumEntries}{get\_num\_entries}
\SetKwFunction{SetNumEntries}{set\_num\_entries}
\SetKwFunction{NumLiveEntries}{num\_live\_entries}
\SetKwFunction{IsInnerNode}{is\_inner\_node}
\SetKwFunction{GarbageCollect}{garbage\_collect}

\KwIn{n: node}
\Begin(\GarbageCollect{n}){
    \If { \IsInnerNode{n} } {
      $v \leftarrow \GetLastConsistentVersion$\; 
      $shift \leftarrow 0$\;
      $y \leftarrow \GetNumEntries{n}$\;
      \For {$i = 1$ to $y$} {
          \If {$n[i].end \neq 0$ and $n[i].end < v$} {
              $n[i].child = null$\;
              $shift++$\;
          }
          \Else {
              \GarbageCollect{$n[i].child$}\;
              \If { $shift \neq 0$ } {
                $n[i - shift].child = n[i].child$\; 
                $n[i - shift].key = n[i].key$\;
                $n[i - shift].start = n[i].start$\;
                $n[i - shift].end = n[i].end$\;
              }
          }
      }
      \SetNumEntries{$n$, $y - shift$}\;
      \If { \GetNumEntries{$n$} = 1 } {
        \tcp{Use only child instead}
      }
    }
}
\caption{CDDS B-Tree Garbage Collection}
\label{alg:btree_gc}
\end{algorithm}
